
const videoData = {
  "Chinese": [
      { title: "Because Of Lov", path: "ngoma/Chinese/Because Of Lov.mp4" },
      { title: "Jin Sheng Yuan ( 今生缘 )", path: "ngoma/Chinese/Jin Sheng Yuan.mp4" },
      { title: "Ni Wen Wo Ai Ni (Lyrics) ~ Teresa Teng ", path: "ngoma/Chinese/Ni Wen Wo Ai Ni (Lyrics) ~ Teresa Teng .mp4" },
      { title: "Peng You (朋友) ~ Wakin Chau", path: "ngoma/Chinese/Peng You (朋友) ~ Wakin Chau.mp4" },
      { title: "Somewhere Over The Rainbow (Lyrics) ~ Israel Kamakawiwoole & Tradução", path: "ngoma/Chinese/Somewhere Over The Rainbow (Lyrics) ~ Israel Kamakawiwoole & Tradução.mp4" },
      { title: "因为爱情 Yin Wei Ai Qing Karena Cinta – 陈奕迅 Eason Chan & 王菲 Faye Wong -Lirik terjemahan ID", path: "ngoma/Chinese/因为爱情 Yin Wei Ai Qing Karena Cinta – 陈奕迅 Eason Chan & 王菲 Faye Wong -Lirik terjemahan ID.mp4" }
  ],
  "East": [
      { title: "Amina By sanaipe Tande", path: "ngoma/East/Amina.mp4" },
      { title: "Bebi Bebi By Nyashinski", path: "ngoma/East/Bebi.mp4" },
      { title: "Chaguo la moyo By Otile Brown", path: "ngoma/East/Chaguo.mp4" },
      { title: "Deadly By Nameless", path: "ngoma/East/Deadly  Nameless.mp4" },
      { title: "Extra pressure By Bensoul", path: "ngoma/East/Extra Bensoul.mp4" },
      { title: "Free By Nyashinski", path: "ngoma/East/Free  Nyashinski.mp4" },
      { title: "Isabella By Sauti Sol", path: "ngoma/East/Isabella  Sauti Sol.mp4" },
      { title: "Koo Koo By Elain", path: "ngoma/East/Koo Koo  Elani.mp4" },
      { title: "Mapenzi By Kidum", path: "ngoma/East/Mapenzi  Kidum.mp4" },
      { title: "Midnight Train By Sauti sol", path: "ngoma/East/Midnight Train  Sauti Sol.mp4" },
      { title: "Moto Moto By Ray C", path: "ngoma/East/Moto Moto  Ray C ft. French Boy.mp4" },
      { title: "Nenda lote By Sauti Sol", path: "ngoma/East/Nenda Lote  Sauti Sol.mp4" },
      { title: "Rhumba By Wanavokali", path: "ngoma/East/Rhumba  Wanavokali.mp4" },
      { title: "Set IT By Dyana Cods", path: "ngoma/East/Set It  Dyana Cods ft. Ajay.mp4" },
      { title: "Sinzia By Nameless", path: "ngoma/East/Sinzia  Nameless.mp4" }
  ],
  "Gospel": [
      { title: "Amazing Grace By Praise & Worship", path: "ngoma/Gospel/Amazing.mp4" },
      { title: "Appointment By  Jimmy Gait", path: "ngoma/Gospel/Appointment By  Jimmy Gait.mp4" },
      { title: "Everything (Amen) By Timi Dakolo", path: "ngoma/Gospel/Everything (Amen) By Timi Dakolo.mp4" },
      { title: "Hallelujah By Alexandra Burke", path: "ngoma/Gospel/Hallelujah By Alexandra Burke.mp4" },
      { title: "One Of Us By Joan Osborne", path: "ngoma/Gospel/One Of Us By Joan Osborne.mp4" },
      { title: "Take My Hand Precious Lord By Elvis Presley", path: "ngoma/Gospel/Take My Hand Precious Lord By Elvis Presley.mp4" },
      { title: "Trust & Obey By  Gospel", path: "ngoma/Gospel/Trust & Obey By  Gospel.mp4" }
  ],
  "Lingala": [
      { title: "Dezo Dezo  By Tshala Mwana", path: "ngoma/Lingala/Dezo Dezo  By Tshala Mwana.mp4" },
      { title: "Show Me The Way By Papa Wemba", path: "ngoma/Lingala/Show Me The Way By Papa Wemba.mp4" }
  ],
  "International": [
      { title: "1 2 Step By  Ciara Ft Missy Elliott", path: "ngoma/International/1 2 Step By  Ciara.mp4" },
      { title: "7 Rings By  Ariana Grande", path: "ngoma/International/7 Rings By  Ariana Grande.mp4" },
      { title: "A Thousand Years By  Christina Perri", path: "ngoma/International/A Thousand Years By  Christina Perri.mp4" },
      { title: "Back At One By Brian McKnight", path: "ngoma/International/Back At One By Brian McKnight.mp4" },
      { title: "Back For Good By Take That", path: "ngoma/International/Back For Good By Take That.mp4" },
      { title: "Be Without You By Mary J. Blige", path: "ngoma/International/Be Without You By Mary J. Blige.mp4" },
      { title: "Call Me By Spagna", path: "ngoma/International/Call Me By Spagna.mp4" },
      { title: "Can We Talk By Tevin Campbell", path: "ngoma/International/Can We Talk By Tevin Campbell.mp4" },
      { title: "Dance With My Father By  Luther Vandross", path: "ngoma/International/Dance With My Father By  Luther Vandross.mp4" },
      { title: "Endless Love By Lionel Richie & Diana Ross", path: "ngoma/International/Endless Love By Lionel Richie & Diana Ross.mp4" },
      { title: "Give Me One Reason By Tracy Chapman", path: "ngoma/International/Give Me One Reason By Tracy Chapman.mp4" },
      { title: "How Will I Know By Whitney Houston", path: "ngoma/International/How Will I Know By Whitney Houston.mp4" },
      { title: "I Have A Dream By ABBA", path: "ngoma/International/I Have A Dream By ABBA.mp4" },
      { title: "True Colors By Phil Collins", path: "ngoma/International/True Colors By Phil Collins.mp4" },
      { title: "Walkin In Memphis  By Marc Cohen", path: "ngoma/International/Walkin In Memphis  By Marc Cohen.mp4" },
      { title: "You're Still The One By Shania Twain", path: "ngoma/International/You're Still The One By Shania Twain.mp4" }
  ],
  "Reggae": [
      { title: "A Woman Like You By  Gramps Morgan", path: "ngoma/Reggae/A Woman Like You By  Gramps Morgan.mp4" },
      { title: "Buffalo Soldier By Bob Marley & The Wailers", path: "ngoma/Reggae/Buffalo Soldier By Bob Marley & The Wailers.mp4" },
      { title: "Iron, Lion, Zion By Bob Marley", path: "ngoma/Reggae/Iron, Lion, Zion By Bob Marley.mp4" },
      { title: "Is This Love By Bob Marley & The Wailers", path: "ngoma/Reggae/Is This Love By Bob Marley & The Wailers.mp4" },
      { title: "Kingston Town By UB40", path: "ngoma/Reggae/Kingston Town By UB40.mp4" },
      { title: "Red Red Wine By UB40", path: "ngoma/Reggae/Red Red Wine By UB40.mp4" },
      { title: "Skankin Sweet By Chronixx", path: "ngoma/Reggae/Skankin Sweet By Chronixx.mp4" },
      { title: "The Way You Do The Things You Do By  UB-40", path: "ngoma/Reggae/The Way You Do The Things You Do By  UB-40.mp4" },
      { title: "Three Little Birds By Bob Marley & The Wailers", path: "ngoma/Reggae/Three Little Birds By Bob Marley & The Wailers.mp4" }
  ]
};

// Function to show video clips for a genre
function showVideos(genre) {
  const videoList = document.getElementById('videoList');
  const videos = videoData[genre] || [];

  // Populate video list dynamically
  videoList.innerHTML = videos
      .map(
          video =>
              `<li><a href="#" onclick="playMedia('${video.path}')">${video.title}</a></li>`
      )
      .join('');
}

// Show Genres on Button Click
function showGenres() {
  const videoButton = document.getElementById('videoButton');
  const content = document.getElementById('content');
  const genresColumn = document.getElementById('genresColumn');
  const itemsColumn = document.getElementById('itemsColumn');
  const genreList = document.getElementById('genreList');
  const liveRequest = document.getElementById('live-request');
  // Hide the button and display genres
  videoButton.classList.add('hidden');
  liveRequest.classList.add('hidden');
  content.classList.remove('hidden');
  itemsColumn.classList.remove('hidden');
  genresColumn.classList.remove('hidden');
  genreList.classList.remove('hidden');

  // Populate genres
  genreList.innerHTML = Object.keys(videoData)
      .map(genre => `<li><a href="#" onclick="showVideos('${genre}')">${genre}</a></li>`)
      .join('');
}
// Play Media
function playMedia(src) {
  const modal = document.getElementById('playerModal');
  const videoPlayer = document.getElementById('mediaPlayer');
  videoPlayer.src = src;

  modal.classList.remove('hidden');
  videoPlayer.play();



// Close Player
function closePlayer() {
  const modal = document.getElementById('closePlayer');
  const videoPlayer = document.getElementById('mediaPlayer');
  videoPlayer.pause();
  videoPlayer.src = '';
  modal.classList.add('hidden');
}

  // Close player automatically when video ends
  videoPlayer.onended = () => {
    closePlayer();
};
}
// Select the elements
const kcont = document.getElementById('kcont');
const ncont = document.getElementById('ncont');
const backbtn = document.getElementById('back-btn');
const backbtn2 = document.getElementById('back-btn2');
const mixcont = document.getElementById('mixcont');
const liveRequestBtn = document.getElementById('live-request');
const qr = document.getElementById('qr');
const genresSection = document.getElementById('genres-section');
const kvidz = document.getElementById('videoButton');
const kvidz2 = document.getElementById('kvidz2');
const searchbar = document.getElementById('search-input');
const container1 = document.getElementById('container1');
const requestForm = document.getElementById("requestForm");
const requestBox = document.getElementById("requestBox");
const requestsDisplay = document.getElementById("requestsDisplay");
const duplicateMessage = document.getElementById("duplicateMessage");
const API_URL = "https://nodayz.onrender.com/requests"; // Replace with your deployed backend URL

// Show request form when button is clicked
liveRequestBtn.addEventListener("click", () => {
  liveRequestBtn.classList.add("hidden");
  requestBox.classList.remove("hidden");
});

// Fetch and display existing requests
async function fetchRequests() {
  try {
    const response = await fetch(API_URL);
    if (!response.ok) {
      throw new Error("Failed to fetch requests");
    }

    const requests = await response.json();

    // Clear and populate the request display
    requestsDisplay.innerHTML = "";
    requests.forEach(({ _id, name, request }) => {
      const requestItem = document.createElement("div");
      requestItem.className = "request-item";
      requestItem.setAttribute("data-id", _id); // Store the request ID for deletion
      requestItem.innerHTML = `
        <strong>${name || "User"}:</strong> ${request}
      `;
      
      // Add long-press event listener for deletion
      addLongPressListener(requestItem, _id);

      requestsDisplay.appendChild(requestItem);
    });
  } catch (error) {
    console.error("Error fetching requests:", error);
  }
}

// Load requests on page load
fetchRequests();

// Handle form submission
requestForm.addEventListener("submit", async (e) => {
  e.preventDefault();

  const musicRequest = document.getElementById("musicRequest").value.trim();
  const userName = document.getElementById("userName").value.trim() || "User";

  if (!musicRequest) {
    alert("Please enter a music request!");
    return;
  }

  try {
    // Check for duplicates
    const response = await fetch(API_URL);
    if (!response.ok) {
      throw new Error("Failed to fetch requests");
    }

    const requests = await response.json();
    const duplicate = requests.some(
      (req) => req.request.toLowerCase() === musicRequest.toLowerCase()
    );

    if (duplicate) {
      duplicateMessage.classList.remove("hidden");
      setTimeout(() => duplicateMessage.classList.add("hidden"), 3000); // Hide after 3 seconds
      return;
    }

    // Post new request
    const newRequest = { name: userName, request: musicRequest };
    const postResponse = await fetch(API_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(newRequest),
    });

    if (!postResponse.ok) {
      throw new Error("Failed to post new request");
    }

    // Clear form fields
    document.getElementById("musicRequest").value = "";
    document.getElementById("userName").value = "";

    // Refresh the display with the updated list of requests
    fetchRequests();
  } catch (error) {
    console.error("Error posting request:", error);
  }
});

// Add long-press functionality to delete a request
function addLongPressListener(element, requestId) {
  let pressTimer;

  // Start timer on mouse down or touch start
  const startPress = () => {
    pressTimer = setTimeout(async () => {
      try {
        const deleteResponse = await fetch(`${API_URL}/${requestId}`, {
          method: "DELETE",
        });

        if (!deleteResponse.ok) {
          throw new Error("Failed to delete request");
        }

        // Refresh the display with the updated list of requests
        fetchRequests();
      } catch (error) {
        console.error("Error deleting request:", error);
      }
    }, 5000); // 5 seconds for long press
  };

  // Clear timer on mouse up, touch end, or leave
  const cancelPress = () => {
    clearTimeout(pressTimer);
  };

  element.addEventListener("mousedown", startPress);
  element.addEventListener("touchstart", startPress);
  element.addEventListener("mouseup", cancelPress);
  element.addEventListener("touchend", cancelPress);
  element.addEventListener("mouseleave", cancelPress);
}

// Periodically refresh requests to reflect auto-deletion (optional, every 1 min)
setInterval(fetchRequests, 60000);


      liveRequestBtn.addEventListener('click', () => {
      // Hide the kcont div
      liveRequestBtn.style.display = 'none';
      kcont.style.display = 'none';
      ncont.style.display = 'none';
      mixcont.style.display = 'none';
      qr.style.display = 'none';
      // Show the genres section      
      requestBox.style.display = 'block';
      backbtn.style.display = 'block';
      searchbar.style.display = 'block';     
    
    });
        kcont.addEventListener('click', () => {
      // Hide the kcont div
      kcont.style.display = 'none';
      backbtn.style.display = 'none';
      ncont.style.display = 'none';
      mixcont.style.display = 'none';
      liveRequestBtn.style.display = 'none';
      qr.style.display = 'none';
      // Show the genres section
      genresSection.style.display = 'block';
      kvidz.style.display = 'block';
      backbtn.style.display = 'block';
      searchbar.style.display = 'block';
    });
        backbtn.addEventListener('click', () => {
      // Hide the kcont div
      kcont.style.display = 'block';     
      ncont.style.display = 'block';
      mixcont.style.display = 'block';
      liveRequestBtn.style.display = 'block';
      qr.style.display = 'block';
      // Show the genres section
      genresSection.style.display = 'none';
      kvidz.style.display = 'none';
      backbtn.style.display = 'none';
      searchbar.style.display = 'none';
      requestBox.style.display = 'none';
      mixxez.style.display = 'none';
    });

        mixcont.addEventListener('click', () => {
      // Hide the mix div
      kcont.style.display = 'none';
      backbtn.style.display = 'none';
      ncont.style.display = 'none';
      mixcont.style.display = 'none';
      liveRequestBtn.style.display = 'none';
      qr.style.display = 'none';
      // Show the genres section
      backbtn.style.display = 'block';
      searchbar.style.display = 'block';
         
    });
        ncont.addEventListener('click', () => {
      // Hide the mix div
      kcont.style.display = 'none';
      backbtn.style.display = 'none';
      ncont.style.display = 'none';
      mixcont.style.display = 'none';
      liveRequestBtn.style.display = 'none';
      qr.style.display = 'none';
      // Show the genres section
      genresSection.style.display = 'block';
      kvidz.style.display = 'none';
      backbtn.style.display = 'block';
      searchbar.style.display = 'block';
     
    });

 

    kvidz.addEventListener('click', () => {
      // Hide the live div
      kcont.style.display = 'none';
      backbtn.style.display = 'none';
      ncont.style.display = 'none';
      mixcont.style.display = 'none';
      liveRequestBtn.style.display = 'none';
      qr.style.display = 'none';
      kvidz.style.display = 'none';
      container1.style.display = 'none';
      // Show the genres section
      
      backbtn2.style.display = 'block';
      searchbar.style.display = 'block';
    });
    backbtn2.addEventListener('click', () => {
      // Hide the live div
      kcont.style.display = 'none';
      backbtn2.style.display = 'none';
      ncont.style.display = 'none';
      mixcont.style.display = 'none';
      liveRequestBtn.style.display = 'none';
      qr.style.display = 'none';
      videoGridSection.style.display = 'none';
      genresSection2.style.display = 'none'; 
      // Show the genres section
      container1.style.display = 'none';
      kvidz.style.display = 'none';
      backbtn.style.display = 'block';
      searchbar.style.display = 'block';
      });


 
// Function to render item list based on category
function displayItems(category) {
  const itemList = document.getElementById("item-list");
  const title = document.getElementById("details-title");

  // Clear previous items
  itemList.innerHTML = "";

  // Update title
  //second colum items
  title.textContent = category ? ` ${category}` : "Select a Category";

  // Add new items
  if (categoryData[category]) {
    categoryData[category].forEach((item) => {
      const listItem = document.createElement("li");
      listItem.textContent = item;
      itemList.appendChild(listItem);
    });
  }
}

// Event listener for category clicks
document.getElementById("category-list").addEventListener("click", (e) => {
  if (e.target.tagName === "LI") {
    const selectedCategory = e.target.getAttribute("data-category");
    displayItems(selectedCategory);
  }
});

// Default view
displayItems();


function openGenre(genre) {
  const genreContent = document.getElementById("genre-content");
  const genresSection = document.getElementById("genres-section");

  // Add current state to history
  genreHistory.push(genresSection.style.display === "none" ? "genre-content" : "genres-section");

  // Show genre content, hide genres list
  genresSection.style.display = "none";
  genreContent.style.display = "block";

  // Update genre title
  const genreTitle = document.getElementById("genre-title");
  genreTitle.textContent = genre;
}
returnBtn.addEventListener("click", () => {
  const genreContent = document.getElementById("genre-content");
  const genresSection = document.getElementById("genres-section");

  // Navigate to the last screen
  const lastScreen = genreHistory.pop();
  if (lastScreen === "genres-section") {
    genresSection.style.display = "block";
    genreContent.style.display = "none";
  } else if (lastScreen === "genre-content") {
    genreContent.style.display = "block";
    genresSection.style.display = "none";
  }
});


// Open a genre and display its content
function openGenre(genre) {
  const genreContent = document.getElementById('genre-content');
  const genreTitle = document.getElementById('genre-title');
  const musicList = document.getElementById('music-list');
  const genresSection = document.getElementById('genres-section');
  const karaokeLogo = document.querySelector('.karaoke-logo');


  // Update genre title
  genreTitle.textContent = "Genre: " + capitalizeFirstLetter(genre);

  // Clear previous list
  musicList.innerHTML = "";

  // Show genre content and hide genres section
  genreContent.classList.remove('hidden');
  genresSection.classList.add('hidden');
  
  
  // Toggle karaoke logo visibility
  if (genre === 'karaoke') {
    karaokeLogo.classList.remove('hidden');
  } else {
    karaokeLogo.classList.add('hidden');
  }

  // Push current genre to history for back navigation
  genreHistory.push(genre);


  // Sample media data for genres
  const mediaData = {
    karaoke: [
      { name: "Song 1", files: ["./resouces/karaoke/video1.mp4", "./resouces/karaoke/audio1.mp3"] },
      { name: "Song 2", files: ["./resouces/karaoke/video2.mp4"] },
      { name: "Song 3", files: ["./resouces/karaoke/audio2.mp3"] }
    ],
    
    mixxez: [
      "./resouces/videos/1.mp4",
      "./resouces/videos/2.mp4",
      "./resouces/videos/audio1.mp3",
      "./resouces/videos/audio2.mp3"
    ],
   
  };

  ////////////////////////////////////////////////// Populate media list based on genre///////////////////////////////////////////////////////////////////////////
  const tracks = mediaData[genre] || [];
  tracks.forEach(item => {
    const li = document.createElement('li');
    li.textContent = typeof item === 'string' ? item : item.name;
    li.classList.add('clickable');
    li.onclick = () => playAudioOrVideo(item.files ? item.files[0] : item);
    musicList.appendChild(li);
  });

  // Animate genres section fading out
  genresSection.style.animation = "fadeOut 0.5s forwards";
  
  // Animate genre content fading in
  genreContent.style.animation = "fadeIn 0.5s forwards";
}

//go back code


// Play selected media (video or audio)
function playAudioOrVideo(track) {
  const mediaPlayer = document.getElementById('media-player');
  const videoPlayer = document.getElementById('video-player');
  const audioPlayer = document.getElementById('audio-player');
  const closeButton = document.getElementById('close-button');

  // Reset player sources and hide both players
  videoPlayer.src = "";
  audioPlayer.src = "";
  videoPlayer.classList.add('hidden');
  audioPlayer.classList.add('hidden');

  // Show media player and close button
  mediaPlayer.classList.remove('hidden');
  closeButton.classList.add('visible');

  // Determine media type and play accordingly
  if (track.endsWith(".mp4")) {
    videoPlayer.src = track;
    videoPlayer.classList.remove('hidden');
    videoPlayer.load();
    videoPlayer.play().catch(error => console.error("Error playing video:", error));
  } else if (track.endsWith(".mp3")) {
    audioPlayer.src = track;
    audioPlayer.classList.remove('hidden');
    audioPlayer.load();
    audioPlayer.play().catch(error => console.error("Error playing audio:", error));
  } else {
    console.log("Unsupported media format:", track);
    alert("This media format is not supported.");
  }

  // Position media player based on screen size
  positionMediaPlayer();
}

// Close the media player
function closePlayer() {
  const mediaPlayer = document.getElementById('media-player');
  const videoPlayer = document.getElementById('video-player');
  const audioPlayer = document.getElementById('audio-player');
  const closeButton = document.getElementById('close-button');

  // Pause and hide media players
  videoPlayer.pause();
  audioPlayer.pause();
  videoPlayer.classList.add('hidden');
  audioPlayer.classList.add('hidden');

  // Hide media player and close button
  mediaPlayer.classList.add('hidden');
  closeButton.classList.remove('visible');
}

// Toggle fullscreen for video player
function toggleFullScreen() {
  const videoPlayer = document.getElementById('video-player');
  if (!document.fullscreenElement) {
    videoPlayer.requestFullscreen().catch(err => {
      console.error(`Error attempting to enable full-screen mode: ${err.message} (${err.name})`);
    });
  } else {
    document.exitFullscreen();
  }
}

// Helper function to capitalize first letter
function capitalizeFirstLetter(string) {
  return string.charAt(0).toUpperCase() + string.slice(1);
}

// Position media player based on screen size
function positionMediaPlayer() {
  const mediaPlayer = document.getElementById('media-player');
  const container = document.querySelector('.container');

  if (window.innerWidth > 768) {
    // Desktop: Position below genre content
    mediaPlayer.style.position = 'absolute';
    mediaPlayer.style.top = '60%';
    mediaPlayer.style.left = '50%';
    mediaPlayer.style.transform = 'translate(-50%, -50%)';
    mediaPlayer.style.width = '50%';
  } else {
    // Mobile: Position below content and QR
    mediaPlayer.style.position = 'relative';
    mediaPlayer.style.top = 'auto';
    mediaPlayer.style.left = 'auto';
    mediaPlayer.style.transform = 'none';
    mediaPlayer.style.width = '90%';
  }
}

// Close player when clicking outside of it
window.onclick = function(event) {
  const mediaPlayer = document.getElementById('media-player');
  if (event.target == mediaPlayer) {
    closePlayer();
  }
}

// Adjust media player position on window resize
window.onresize = function() {
  if (!document.getElementById('media-player').classList.contains('hidden')) {
    positionMediaPlayer();
  }
}

